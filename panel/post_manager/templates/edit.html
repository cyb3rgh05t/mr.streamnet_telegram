<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <title>Edit Post</title>
    <script>
      function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== "") {
          const cookies = document.cookie.split(";");
          for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === name + "=") {
              cookieValue = decodeURIComponent(
                cookie.substring(name.length + 1)
              );
              break;
            }
          }
        }
        return cookieValue;
      }

      function updatePost(postId) {
        const csrftoken = getCookie("csrftoken");
        const newContent = document.getElementById("postContent").value; // Get the new content

        fetch(`/edit/${postId}/`, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "X-CSRFToken": csrftoken, // Include CSRF token in the request
          },
          body: JSON.stringify({ content: newContent }),
        })
          .then((response) => response.json())
          .then((data) => {
            if (data.status === "success") {
              alert("Post updated successfully!");
              window.location.href = "/"; // Redirect or update the UI as needed
            }
          })
          .catch((error) => console.error("Error:", error));
      }
    </script>
  </head>
  <body>
    <h1>Edit Post</h1>
    <form
      id="editPostForm"
      onsubmit="event.preventDefault(); updatePost({{ post.id }});"
    >
      {% csrf_token %}
      <textarea id="postContent" required>{{ post.content }}</textarea><br />
      <button type="submit">Update Post</button>
    </form>
    <a href="{% url 'index' %}">Back to Posts</a>
  </body>
</html>
